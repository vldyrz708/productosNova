openapi: 3.0.3
info:
  title: API de Álbumes Musicales
  version: 1.0.0
  description: >
    API REST para gestionar álbumes musicales.
    Documentación alineada con modules/Album.js y albumController.js.

servers:
  - url: http://localhost:3001/api
    description: Servidor local de desarrollo

paths:
  /albums:
    get:
      summary: Obtener todos los álbumes con paginación y filtros
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            default: 10
        - in: query
          name: artista
          schema:
            type: string
        - in: query
          name: categoria
          schema:
            type: string
          description: "Lista separada por comas (ej: K-Pop,Rock)"
        - in: query
          name: disponible
          schema:
            type: boolean
        - in: query
          name: precioMin
          schema:
            type: number
            minimum: 0
        - in: query
          name: precioMax
          schema:
            type: number
            minimum: 0
      responses:
        '200':
          description: Lista de álbumes con paginación
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumListResponse'

    post:
      summary: Crear un nuevo álbum
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumInput'
            examples:
              ejemplo-valido:
                value:
                  nombreAlbum: "The Album"
                  artista: "BLACKPINK"
                  versionAlbum: "Standard"
                  fechaLanzamiento: "2025-12-06"
                  idioma: ["Coreano","Inglés"]
                  duracion: "42:30"
                  pesoGramos: 120
                  precio: 350.0
                  stock: 10
                  categoria: ["K-Pop"]
                  descripcion: "Edición especial con photobook."
                  fotoAlbum: "cover.jpg"
                  fechaAdquisicion: "2025-11-13"
                  fechaLimiteVenta: "2025-12-31"
      responses:
        '201':
          description: Álbum creado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumResponse'
        '400':
          description: Error de validación

  /albums/{id}:
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
    get:
      summary: Obtener un álbum por ID
      responses:
        '200':
          description: Álbum encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumResponse'
        '404':
          description: Álbum no encontrado
    put:
      summary: Reemplazar un álbum (PUT)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumInput'
      responses:
        '200':
          description: Álbum actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumResponse'
        '400':
          description: Error de validación
        '404':
          description: Álbum no encontrado
    patch:
      summary: Actualizar parcialmente un álbum (PATCH)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AlbumPatch'
      responses:
        '200':
          description: Álbum actualizado parcialmente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumResponse'
        '404':
          description: Álbum no encontrado
    delete:
      summary: Eliminar un álbum
      responses:
        '200':
          description: Álbum eliminado correctamente
        '404':
          description: Álbum no encontrado

  /albums/search:
    get:
      summary: Buscar álbumes por texto y filtros
      parameters:
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: categoria
          schema:
            type: string
        - in: query
          name: artista
          schema:
            type: string
        - in: query
          name: precioMin
          schema:
            type: number
        - in: query
          name: precioMax
          schema:
            type: number
        - in: query
          name: disponible
          schema:
            type: boolean
        - in: query
          name: page
          schema:
            type: integer
        - in: query
          name: limit
          schema:
            type: integer
      responses:
        '200':
          description: Resultados de búsqueda
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SearchResponse'

  /albums/artista/{artista}:
    get:
      summary: Obtener álbumes por artista
      parameters:
        - in: path
          name: artista
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Álbumes por artista
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumListResponse'

  /albums/categoria/{categoria}:
    get:
      summary: Obtener álbumes por categoría
      parameters:
        - in: path
          name: categoria
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Álbumes por categoría
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumListResponse'

  /albums/{id}/stock:
    patch:
      summary: Actualizar stock de un álbum (incremento con "cantidad")
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - cantidad
              properties:
                cantidad:
                  type: number
                  description: "Número (positivo/negativo) para incrementar o decrementar stock"
      responses:
        '200':
          description: Stock actualizado correctamente
        '400':
          description: Datos inválidos
        '404':
          description: Álbum no encontrado

  /albums/stats:
    get:
      summary: Obtener estadísticas de álbumes
      responses:
        '200':
          description: Estadísticas generales
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlbumStatsResponse'

components:
  schemas:
    # Respuesta estándar para un álbum
    AlbumResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          $ref: '#/components/schemas/Album'
        message:
          type: string

    # Modelo de Album (según albumSchema)
    Album:
      type: object
      properties:
        _id:
          type: string
          readOnly: true
        nombreAlbum:
          type: string
          maxLength: 100
        artista:
          type: string
          maxLength: 80
        versionAlbum:
          type: string
          enum:
            - "Standard"
            - "Deluxe"
            - "Limited Edition"
            - "Special Edition"
            - "Repackage"
            - "Mini Album"
            - "Single"
        fechaLanzamiento:
          type: string
          format: date
        idioma:
          type: array
          items:
            type: string
            enum:
              - "Coreano"
              - "Japonés"
              - "Inglés"
              - "Chino"
              - "Tailandés"
              - "Español"
              - "Otro"
        duracion:
          type: string
          description: "Formato MM:SS o HH:MM:SS"
          pattern: "^([0-9]{1,2}:)?[0-5]?[0-9]:[0-5][0-9]$"
        pesoGramos:
          type: number
          minimum: 1
          maximum: 2000
        precio:
          type: number
          minimum: 0
        stock:
          type: integer
          minimum: 0
        categoria:
          type: array
          items:
            type: string
            enum:
              - "K-Pop"
              - "J-Pop"
              - "Boy Group"
              - "Girl Group"
              - "Solista"
              - "Ballad"
              - "Dance"
              - "R&B"
              - "Hip-Hop"
              - "Rock"
              - "Indie"
        descripcion:
          type: string
          maxLength: 1000
        fotoAlbum:
          type: string
        fechaAdquisicion:
          type: string
          format: date
        fechaLimiteVenta:
          type: string
          format: date
        palabrasClave:
          type: array
          items:
            type: string
          readOnly: true
        disponibleVenta:
          type: boolean
          readOnly: true
        diasRestantesVenta:
          type: integer
          readOnly: true
        createdAt:
          type: string
          format: date-time
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          readOnly: true
      required:
        - nombreAlbum
        - artista
        - versionAlbum
        - fechaLanzamiento
        - idioma
        - duracion
        - pesoGramos
        - precio
        - stock
        - categoria
        - descripcion
        - fotoAlbum
        - fechaAdquisicion
        - fechaLimiteVenta

    # Input para crear / PUT (mismos required que el schema)
    AlbumInput:
      type: object
      required:
        - nombreAlbum
        - artista
        - versionAlbum
        - fechaLanzamiento
        - idioma
        - duracion
        - pesoGramos
        - precio
        - stock
        - categoria
        - descripcion
        - fotoAlbum
        - fechaAdquisicion
        - fechaLimiteVenta
      properties:
        nombreAlbum:
          type: string
          maxLength: 100
        artista:
          type: string
          maxLength: 80
        versionAlbum:
          type: string
          enum:
            - "Standard"
            - "Deluxe"
            - "Limited Edition"
            - "Special Edition"
            - "Repackage"
            - "Mini Album"
            - "Single"
        fechaLanzamiento:
          type: string
          format: date
        idioma:
          type: array
          items:
            type: string
            enum:
              - "Coreano"
              - "Japonés"
              - "Inglés"
              - "Chino"
              - "Tailandés"
              - "Español"
              - "Otro"
        duracion:
          type: string
          pattern: "^([0-9]{1,2}:)?[0-5]?[0-9]:[0-5][0-9]$"
        pesoGramos:
          type: number
          minimum: 1
          maximum: 2000
        precio:
          type: number
          minimum: 0
        stock:
          type: integer
          minimum: 0
        categoria:
          type: array
          items:
            type: string
            enum:
              - "K-Pop"
              - "J-Pop"
              - "Boy Group"
              - "Girl Group"
              - "Solista"
              - "Ballad"
              - "Dance"
              - "R&B"
              - "Hip-Hop"
              - "Rock"
              - "Indie"
        descripcion:
          type: string
          maxLength: 1000
        fotoAlbum:
          type: string
        fechaAdquisicion:
          type: string
          format: date
        fechaLimiteVenta:
          type: string
          format: date

    # PATCH input (opcional, no required)
    AlbumPatch:
      type: object
      properties:
        nombreAlbum:
          type: string
          maxLength: 100
        artista:
          type: string
          maxLength: 80
        versionAlbum:
          type: string
          enum:
            - "Standard"
            - "Deluxe"
            - "Limited Edition"
            - "Special Edition"
            - "Repackage"
            - "Mini Album"
            - "Single"
        fechaLanzamiento:
          type: string
          format: date
        idioma:
          type: array
          items:
            type: string
            enum:
              - "Coreano"
              - "Japonés"
              - "Inglés"
              - "Chino"
              - "Tailandés"
              - "Español"
              - "Otro"
        duracion:
          type: string
          pattern: "^([0-9]{1,2}:)?[0-5]?[0-9]:[0-5][0-9]$"
        pesoGramos:
          type: number
          minimum: 1
          maximum: 2000
        precio:
          type: number
          minimum: 0
        stock:
          type: integer
          minimum: 0
        categoria:
          type: array
          items:
            type: string
            enum:
              - "K-Pop"
              - "J-Pop"
              - "Boy Group"
              - "Girl Group"
              - "Solista"
              - "Ballad"
              - "Dance"
              - "R&B"
              - "Hip-Hop"
              - "Rock"
              - "Indie"
        descripcion:
          type: string
          maxLength: 1000
        fotoAlbum:
          type: string
        fechaAdquisicion:
          type: string
          format: date
        fechaLimiteVenta:
          type: string
          format: date

    AlbumListResponse:
      type: object
      properties:
        success:
          type: boolean
        albums:
          type: array
          items:
            $ref: '#/components/schemas/Album'
        pagination:
          type: object
          properties:
            page: { type: integer }
            limit: { type: integer }
            total: { type: integer }
            pages: { type: integer }
            hasNext: { type: boolean }
            hasPrev: { type: boolean }

    SearchResponse:
      type: object
      properties:
        success: { type: boolean }
        data:
          type: array
          items:
            $ref: '#/components/schemas/Album'
        pagination:
          type: object
          properties:
            page: { type: integer }
            limit: { type: integer }
            total: { type: integer }
            pages: { type: integer }
        searchQuery: { type: string }

    AlbumStatsResponse:
      type: object
      properties:
        success: { type: boolean }
        data:
          type: object
          properties:
            totalAlbumes: { type: integer }
            albumesDisponibles: { type: integer }
            albumesAgotados: { type: integer }
            estadisticasPorCategoria:
              type: array
              items:
                type: object
                properties:
                  _id: { type: string }
                  count: { type: integer }
            albumesMasCaros:
              type: array
              items:
                type: object
                properties:
                  nombreAlbum: { type: string }
                  artista: { type: string }
                  precio: { type: number }
